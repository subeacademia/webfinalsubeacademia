<div class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200" *ngIf="course() as course">
  <!-- Encabezado del Curso -->
  <header class="bg-white dark:bg-gray-800 py-12 border-b dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <a [routerLink]="['/', i18n.currentLang(), 'cursos']" class="text-sm text-indigo-600 dark:text-indigo-400 hover:underline mb-4 inline-block">&larr; {{ 'course.back_to_courses' | i18nTranslate }}</a>
      <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 dark:text-white">{{ course.title }}</h1>
      <p class="mt-4 text-xl text-gray-600 dark:text-gray-400">{{ course.description || course.summary }}</p>
    </div>
  </header>

  <!-- Contenido y Barra Lateral -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="lg:grid lg:grid-cols-12 lg:gap-12">
      <!-- Contenido Principal (Izquierda) -->
      <div class="lg:col-span-8">
        <div class="mb-8 rounded-lg overflow-hidden shadow-lg">
          <img [src]="course.image || '/assets/og-placeholder.svg'" [alt]="course.title" class="w-full object-cover">
        </div>
        <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">{{ 'course.syllabus_title' | i18nTranslate }}</h2>
        <!-- Acordeón del Temario -->
        <div class="space-y-4" *ngIf="course.modules?.length; else noModules">
          <div *ngFor="let module of course.modules; let i = index" class="border dark:border-gray-700 rounded-lg overflow-hidden">
            <button (click)="toggleModule(i)" class="w-full flex justify-between items-center p-4 text-left bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
              <span class="text-lg font-semibold">{{ module.title }}</span>
              <svg class="w-6 h-6 transition-transform" [class.rotate-180]="activeModule === i" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </button>
            <div *ngIf="activeModule === i" class="p-4 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
              <ul class="list-disc pl-5 space-y-2 text-gray-600 dark:text-gray-400">
                <li *ngFor="let lesson of module.lessons">{{ lesson }}</li>
              </ul>
            </div>
          </div>
        </div>
        <ng-template #noModules>
          <p class="text-gray-600 dark:text-gray-400">El temario estará disponible pronto.</p>
        </ng-template>

        <!-- Recursos opcionales si existen -->
        <section *ngIf="$any(course).resources?.length" class="mt-10">
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Recursos</h3>
          <ul class="list-disc pl-6 space-y-2">
            <li *ngFor="let r of $any(course).resources">
              <a [href]="r.url" target="_blank" rel="noopener" class="text-indigo-600 dark:text-indigo-400 hover:underline transition-colors">
                {{ r.title || r.type }}
              </a>
            </li>
          </ul>
        </section>
      </div>

      <!-- Barra Lateral (Derecha) -->
      <aside class="lg:col-span-4 mt-12 lg:mt-0">
        <div class="sticky top-24 bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6">
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">{{ 'course.details_title' | i18nTranslate }}</h3>
            <ul class="space-y-3 text-gray-600 dark:text-gray-400">
            <li class="flex items-center gap-3"><svg class="w-5 h-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span><strong>{{ 'course.duration' | i18nTranslate }}:</strong> {{ $any(course).duration || ($any(course).durationHours ? $any(course).durationHours + ' h' : '—') }}</span></li>
            <li class="flex items-center gap-3"><svg class="w-5 h-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M4 6h16M4 12h16M4 18h16"></path></svg> <span><strong>{{ 'course.lessons' | i18nTranslate }}:</strong> {{ $any(course).lessonCount || '—' }}</span></li>
            <li class="flex items-center gap-3"><svg class="w-5 h-5 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M7 11l5-5m0 0l5 5m-5-5v12"></path></svg> <span><strong>{{ 'course.level' | i18nTranslate }}:</strong> {{ $any(course).level }}</span></li>
          </ul>
          <!-- Información de Precio -->
          <div *ngIf="course.price !== undefined && course.price !== null" class="mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <div class="text-center">
              <div class="text-2xl font-bold text-green-600 dark:text-green-400">
                {{ formatPrice(course.price, course.currency) }}
              </div>
              <div class="text-sm text-gray-600 dark:text-gray-400">
                {{ course.currency === 'CLP' ? 'Peso Chileno' : course.currency === 'EUR' ? 'Euro' : 'Dólar' }}
              </div>
            </div>
          </div>

          <!-- Botón de Compra/Acceso -->
          <ng-container *ngIf="course.price && course.price > 0 && course.paymentLink; else freeAccess">
            <button 
              (click)="goToPayment()"
              class="mt-6 w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors">
              Comprar Curso por {{ formatPrice(course.price, course.currency) }}
            </button>
          </ng-container>
          <ng-template #freeAccess>
            <button class="mt-6 w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors">
              Acceder Gratis
            </button>
          </ng-template>
        </div>
      </aside>
    </div>
  </div>
</div>


