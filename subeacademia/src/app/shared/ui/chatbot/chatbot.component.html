<div class="fixed bottom-6 right-6 z-50">
  <!-- BotÃ³n Flotante Animado -->
  <button *ngIf="!isOpen" (click)="toggleChat()" class="animate-pulse-slow bg-indigo-600 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg hover:bg-indigo-700 transition-all">
    <!-- Icono de IA (Robot) -->
    <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A2,2,0,0,1,14,4V6H10V4A2,2,0,0,1,12,2M20,12V20A2,2,0,0,1,18,22H6A2,2,0,0,1,4,20V12H5.5A2.5,2.5,0,0,0,8,9.5V8H16V9.5A2.5,2.5,0,0,0,18.5,12H20M16,14H13V16H16V14M11,14H8V16H11V14Z"/></svg>
  </button>

  <!-- Ventana del Chatbox -->
  <div *ngIf="isOpen" class="w-80 sm:w-96 h-[32rem] bg-white dark:bg-gray-800 rounded-2xl shadow-2xl flex flex-col transition-all duration-300 ease-out transform origin-bottom-right" [class.scale-100]="isOpen" [class.opacity-100]="isOpen" [class.scale-95]="!isOpen" [class.opacity-0]="!isOpen">
    <!-- Header -->
    <div class="flex justify-between items-center p-4 bg-indigo-600 text-white rounded-t-2xl">
      <h3 class="font-bold">{{ 'chatbot.header_title' | i18nTranslate }}</h3>
      <button (click)="toggleChat()" class="hover:bg-indigo-700 p-1 rounded-full">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
      </button>
    </div>

    <!-- Mensajes -->
    <div #scrollContainer class="flex-1 p-4 overflow-y-auto space-y-4">
      <div *ngFor="let msg of messages" [ngClass]="{'justify-end': msg.sender === 'user', 'justify-start': msg.sender === 'bot'}" class="flex">
        <div [ngClass]="{'bg-indigo-500 text-white': msg.sender === 'user', 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200': msg.sender === 'bot'}" class="rounded-lg py-2 px-4 max-w-xs prose dark:prose-invert" [innerHTML]="msg.text">
        </div>
      </div>
      <div *ngIf="isLoading" class="flex justify-start">
          <div class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg py-2 px-4 max-w-xs">
              <span class="animate-pulse">...</span>
          </div>
      </div>
    </div>

    <!-- Starter Questions -->
    <div class="p-2 border-t dark:border-gray-700">
      <div class="flex flex-wrap gap-2 justify-center">
        <button *ngFor="let q of starterQuestions" (click)="sendMessage(q)" class="text-xs bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-full px-3 py-1 transition-colors">
          {{ q | i18nTranslate }}
        </button>
      </div>
    </div>

    <!-- Input -->
    <div class="p-4 border-t dark:border-gray-700">
      <form (ngSubmit)="sendMessage()" class="flex gap-2">
        <input [(ngModel)]="userInput" name="userInput" type="text" [placeholder]="'chatbot.input_placeholder' | i18nTranslate" class="flex-1 px-4 py-2 border dark:border-gray-600 rounded-full bg-gray-50 dark:bg-gray-700 focus:ring-indigo-500 focus:border-indigo-500">
        <button type="submit" [disabled]="isLoading" class="bg-indigo-600 text-white rounded-full w-10 h-10 flex-shrink-0 flex items-center justify-center hover:bg-indigo-700 transition-colors disabled:bg-gray-400">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path></svg>
        </button>
      </form>
    </div>
  </div>
</div>


