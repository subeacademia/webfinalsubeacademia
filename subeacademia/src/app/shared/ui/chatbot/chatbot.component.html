<div class="fixed bottom-4 right-4 sm:bottom-6 sm:right-6 z-50">
  <!-- BotÃ³n Flotante Animado -->
  <button *ngIf="!isOpen" (click)="toggleChat()" class="animate-pulse-slow bg-indigo-600 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-lg hover:bg-indigo-700 transition-all">
    <!-- Icono de IA (Cerebro/Chip) -->
    <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 00-10 10c0 4.42 2.87 8.17 6.84 9.5.6.11.82-.26.82-.58v-2.15c-2.78.6-3.37-1.34-3.37-1.34-.55-1.39-1.34-1.76-1.34-1.76-1.09-.74.08-.73.08-.73 1.2.09 1.83 1.23 1.83 1.23 1.07 1.83 2.81 1.3 3.5 1 .1-.78.42-1.3.76-1.6-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.23-3.22-.12-.3-.54-1.52.12-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 016 0c2.3-1.55 3.3-1.23 3.3-1.23.66 1.66.24 2.88.12 3.18.77.84 1.23 1.91 1.23 3.22 0 4.61-2.8 5.62-5.47 5.92.43.37.82 1.1.82 2.22v3.29c0 .31.22.69.82.58A10 10 0 0022 12 10 10 0 0012 2z"/></svg>
  </button>

  <!-- Ventana del Chatbox -->
  <div *ngIf="isOpen" class="w-[calc(100vw-2rem)] h-[calc(100vh-5rem)] sm:w-96 sm:h-[32rem] bg-white dark:bg-gray-800 rounded-2xl shadow-2xl flex flex-col transition-all duration-300 ease-out transform origin-bottom-right" [class.scale-100]="isOpen" [class.opacity-100]="isOpen" [class.scale-95]="!isOpen" [class.opacity-0]="!isOpen">
    <!-- Header -->
    <div class="flex justify-between items-center p-4 bg-indigo-600 text-white rounded-t-2xl flex-shrink-0">
      <h3 class="font-bold">{{ 'chatbot.header_title' | i18nTranslate }}</h3>
      <button (click)="toggleChat()" class="hover:bg-indigo-700 p-1 rounded-full">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
      </button>
    </div>

    <!-- Mensajes -->
    <div #scrollContainer class="flex-1 p-4 overflow-y-auto space-y-4">
      <div *ngFor="let msg of messages" [ngClass]="{'justify-end': msg.sender === 'user', 'justify-start': msg.sender === 'bot'}" class="flex">
        <div [ngClass]="{'bg-indigo-500 text-white': msg.sender === 'user', 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200': msg.sender === 'bot'}" class="rounded-lg py-2 px-4 max-w-xs prose dark:prose-invert" [innerHTML]="msg.text">
        </div>
      </div>
      <div *ngIf="isLoading" class="flex justify-start">
          <div class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg py-2 px-4 max-w-xs">
              <span class="animate-pulse">...</span>
          </div>
      </div>
    </div>

    <!-- Starter Questions -->
    <div class="p-2 border-t dark:border-gray-700 flex-shrink-0">
      <div class="flex flex-wrap gap-2 justify-center">
        <button *ngFor="let q of starterQuestions" (click)="sendMessage(q)" class="text-xs bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-full px-3 py-1 transition-colors">
          {{ q | i18nTranslate }}
        </button>
      </div>
    </div>

    <!-- Input -->
    <div class="p-4 border-t dark:border-gray-700 flex-shrink-0">
      <form (ngSubmit)="sendMessage()" class="flex gap-2">
        <input [(ngModel)]="userInput" name="userInput" type="text" [placeholder]="'chatbot.input_placeholder' | i18nTranslate" class="flex-1 px-4 py-2 border dark:border-gray-600 rounded-full bg-gray-50 dark:bg-gray-700 focus:ring-indigo-500 focus:border-indigo-500">
        <button type="submit" [disabled]="isLoading" class="bg-indigo-600 text-white rounded-full w-10 h-10 flex-shrink-0 flex items-center justify-center hover:bg-indigo-700 transition-colors disabled:bg-gray-400">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path></svg>
        </button>
      </form>
    </div>
  </div>
</div>


