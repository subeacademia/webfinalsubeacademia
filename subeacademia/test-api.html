<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Vercel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { border-color: #4CAF50; background-color: #f1f8e9; }
        .error { border-color: #f44336; background-color: #ffebee; }
        .loading { border-color: #2196F3; background-color: #e3f2fd; }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #1976D2; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .status {
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de API Vercel - Sube Academ-IA</h1>
        <p>Esta p√°gina permite probar la conexi√≥n con la API de Vercel para generar diagn√≥sticos de IA.</p>

        <div class="test-section" id="connection-test">
            <h3>üîó Test de Conexi√≥n</h3>
            <button onclick="testConnection()">Probar Conexi√≥n</button>
            <div id="connection-status" class="status"></div>
            <pre id="connection-result"></pre>
        </div>

        <div class="test-section" id="api-test">
            <h3>ü§ñ Test de Generaci√≥n de Diagn√≥stico</h3>
            <button onclick="testDiagnosticGeneration()">Generar Diagn√≥stico de Prueba</button>
            <div id="api-status" class="status"></div>
            <pre id="api-result"></pre>
        </div>

        <div class="test-section" id="diagnostic-data">
            <h3>üìä Datos de Diagn√≥stico de Prueba</h3>
            <button onclick="showDiagnosticData()">Mostrar Datos</button>
            <pre id="diagnostic-data-result"></pre>
        </div>
    </div>

    <script>
        const API_URL = 'https://apisube-smoky.vercel.app/api/azure/generate';
        
        // Datos de diagn√≥stico de prueba
        const testDiagnosticData = {
            contexto: {
                industria: "Tecnolog√≠a",
                tamanoEquipo: 50,
                objetivo: "innovacion"
            },
            ares: {
                respuestas: {
                    "adopcion_01": 4,
                    "riesgos_01": 3,
                    "etica_01": 4,
                    "seguridad_01": 3,
                    "capacidad_01": 4,
                    "datos_01": 3,
                    "gobernanza_01": 4,
                    "valor_01": 3,
                    "operacion_01": 3,
                    "talento_01": 4,
                    "tecnologia_01": 4,
                    "integracion_01": 3,
                    "cumplimiento_01": 3,
                    "transparencia_01": 4,
                    "sostenibilidad_01": 3
                }
            },
            competencias: {
                niveles: {
                    "c1_pensamiento_critico": "avanzado",
                    "c2_resolucion_problemas": "intermedio",
                    "c3_creatividad": "avanzado",
                    "c4_colaboracion": "intermedio",
                    "c5_comunicacion": "avanzado",
                    "c6_adaptabilidad": "intermedio",
                    "c7_liderazgo": "avanzado",
                    "c8_etica": "intermedio",
                    "c9_tecnologia": "avanzado",
                    "c10_datos": "intermedio",
                    "c11_aprendizaje": "avanzado",
                    "c12_innovacion": "avanzado",
                    "c13_sostenibilidad": "intermedio"
                }
            },
            lead: {
                nombre: "Usuario de Prueba",
                email: "test@example.com"
            }
        };

        async function testConnection() {
            const statusEl = document.getElementById('connection-status');
            const resultEl = document.getElementById('connection-result');
            const sectionEl = document.getElementById('connection-test');
            
            sectionEl.className = 'test-section loading';
            statusEl.textContent = 'üîÑ Probando conexi√≥n...';
            resultEl.textContent = '';

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: 'Test de conexi√≥n - responde con "Conexi√≥n exitosa"'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    sectionEl.className = 'test-section success';
                    statusEl.textContent = '‚úÖ Conexi√≥n exitosa';
                    resultEl.textContent = JSON.stringify(data, null, 2);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                sectionEl.className = 'test-section error';
                statusEl.textContent = '‚ùå Error de conexi√≥n';
                resultEl.textContent = `Error: ${error.message}`;
            }
        }

        async function testDiagnosticGeneration() {
            const statusEl = document.getElementById('api-status');
            const resultEl = document.getElementById('api-result');
            const sectionEl = document.getElementById('api-test');
            
            sectionEl.className = 'test-section loading';
            statusEl.textContent = 'ü§ñ Generando diagn√≥stico...';
            resultEl.textContent = '';

            const prompt = `
**Rol:** Eres un consultor experto en transformaci√≥n digital e inteligencia artificial.

**Contexto:** Un usuario ha completado un diagn√≥stico de madurez en IA.

**Datos del Diagn√≥stico del Usuario:**

**1. Contexto Organizacional:**
- Industria: ${testDiagnosticData.contexto.industria}
- Tama√±o del equipo: ${testDiagnosticData.contexto.tamanoEquipo} personas
- Objetivo: ${testDiagnosticData.contexto.objetivo}

**2. Resultados del ARES-AI Framework:**
- Adopci√≥n: 4/5
- Riesgos: 3/5
- √âtica: 4/5
- Seguridad: 3/5
- Capacidad: 4/5

**3. Resultados de Competencias:**
- Pensamiento Cr√≠tico: Avanzado
- Resoluci√≥n de Problemas: Intermedio
- Creatividad: Avanzado
- Colaboraci√≥n: Intermedio
- Comunicaci√≥n: Avanzado

**Tarea:** Genera un informe breve en formato MARKDOWN con an√°lisis general y 3 recomendaciones clave.
            `;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prompt: prompt
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    sectionEl.className = 'test-section success';
                    statusEl.textContent = '‚úÖ Diagn√≥stico generado exitosamente';
                    resultEl.textContent = data.result || JSON.stringify(data, null, 2);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                sectionEl.className = 'test-section error';
                statusEl.textContent = '‚ùå Error al generar diagn√≥stico';
                resultEl.textContent = `Error: ${error.message}`;
            }
        }

        function showDiagnosticData() {
            const resultEl = document.getElementById('diagnostic-data-result');
            resultEl.textContent = JSON.stringify(testDiagnosticData, null, 2);
        }

        // Test autom√°tico al cargar la p√°gina
        window.onload = function() {
            console.log('üß™ P√°gina de test cargada');
            console.log('üîó API URL:', API_URL);
            console.log('üìä Datos de prueba:', testDiagnosticData);
        };
    </script>
</body>
</html>
